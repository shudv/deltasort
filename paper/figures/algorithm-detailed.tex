\begin{algorithm}[H]
\caption{DeltaSort}
\label{alg:deltasort}
\begin{algorithmic}[1]
\Require Array $A[0..n-1]$, updated indices $U$, comparator $\texttt{cmp}$
\Ensure $A$ is sorted
\Statex
\State \textbf{Phase 1: Prepare}
\State $\texttt{updated} \gets \text{sort}(U)$ \Comment{Sort indices ascending}
\State $\texttt{values} \gets [A[u] : u \in \texttt{updated}]$
\State $\texttt{values} \gets \text{sort}(\texttt{values}, \texttt{cmp})$
\For{$i \gets 0$ \textbf{to} $|\texttt{updated}| - 1$}
    \State $A[\texttt{updated}[i]] \gets \texttt{values}[i]$
\EndFor
\Statex
\State \textbf{Phase 2: Repair}
\State $\texttt{pendingRight} \gets []$; $\texttt{leftBound} \gets 0$
\For{$p \gets 0$ \textbf{to} $|\texttt{updated}| - 1$}
    \State $i \gets \texttt{updated}[p]$
    \If{$\Call{GetDirection}{A, i} = \textsc{Left}$}
        \State $\texttt{rightBound} \gets i - 1$ \Comment{Fix pending before LEFT}
        \While{$\texttt{pendingRight} \neq \emptyset$}
            \State $\texttt{rightBound} \gets \Call{FixRightViolation}{A, \texttt{pendingRight.pop}(), \texttt{rightBound}} - 1$
        \EndWhile
        \State $\texttt{leftBound} \gets \Call{FixLeftViolation}{A, i, \texttt{leftBound}} + 1$
    \Else
        \State $\texttt{pendingRight.push}(i)$ \Comment{Defer RIGHT}
    \EndIf
\EndFor
\Statex
\State $\texttt{rightBound} \gets n - 1$ \Comment{Fix remaining pending RIGHT violations}
\While{$\texttt{pendingRight} \neq \emptyset$}
    \State $\texttt{rightBound} \gets \Call{FixRightViolation}{A, \texttt{pendingRight.pop}(), \texttt{rightBound}} - 1$
\EndWhile
\end{algorithmic}
\end{algorithm}

\vspace{0.5em}

\noindent\begin{minipage}{\linewidth}
\begin{algorithmic}[1]
\Function{GetDirection}{$A$, $i$}
    \State \Return $i > 0 \land \texttt{cmp}(A[i-1], A[i]) > 0$ ? \textsc{Left} : \textsc{Right}
\EndFunction
\end{algorithmic}
\end{minipage}

\vspace{0.5em}

\noindent\begin{minipage}{\linewidth}
\begin{algorithmic}[1]
\Function{FixLeftViolation}{$A$, $i$, $\texttt{leftBound}$}
    \State $t \gets \Call{BinarySearchLeft}{A, A[i], \texttt{leftBound}, i-1}$
    \State \Call{Move}{A, i, t}
    \State \Return $t$
\EndFunction
\end{algorithmic}
\end{minipage}

\vspace{0.5em}

\noindent\begin{minipage}{\linewidth}
\begin{algorithmic}[1]
\Function{FixRightViolation}{$A$, $i$, $\texttt{rightBound}$}
    \If{$i < n-1 \land \texttt{cmp}(A[i], A[i+1]) > 0$} \Comment{Check if fixing is needed}
        \State $t \gets \Call{BinarySearchRight}{A, A[i], i+1, \texttt{rightBound}}$
        \State \Call{Move}{A, i, t}
        \State \Return $t$
    \EndIf
    \State \Return $i$ \Comment{No movement needed}
\EndFunction
\end{algorithmic}
\end{minipage}
